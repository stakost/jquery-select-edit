!function(a){"use strict";var b,c="selectEdit",d=27,e=38,f=40,g=39,h=37,i=13,j=a(document),k=a(window),l="select-edit",m=l+"_disabled",n=l+"__select",o=n+"_open",p=n+"_empty",q=n+"__current",r=l+"-drop",s=r+"_show-up",t=r+"_show-down",u=r+"_show",v=l+"__tooltip",w=l+"__results",x=l+"__submit-box",y=l+"__submit",z=l+"__search-box",A=l+"__search-input",B=w,C=w+"__item",D=C+"_marked",E=C+"_hover",F=C+"_selected",G=l+"-loader",H=5,I={up:s,down:t},J={type:"GET",delay:500,resPath:"res",load:!0,resFormat:function(a){return a.res?a.res:a}},K=!1,L=Object.prototype.toString,M=function(a){return"function"==typeof a},N=function(a){return"[object String]"==L.call(a)},O=function(a){return"[object Array]"==L.call(a)},P=function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(a[c]);return b};b=function(b,d){var e=d.ajax;this.$select=a(b),this.options=d,this.isAjax=e&&e.load,this.isAjaxSearch=e&&e.search,this.isAjaxSave=e&&e.save,this.requestCounter=0;var f=this.$select;return f.is("select")?(this.isAjax&&f.prop("multiple",!0),this.isAjaxSearch&&(f.prop("multiple",!0),this.options.search=!0),f.attr("autocomplete","off"),this.isMultiple=f.prop("multiple"),this.isDisabled=f.prop("disabled"),this._fixSelect(),void this.initialize()):(console.warn(c,"Sorry, only select element!"),!1)},b.DEFAULTS={tmplContent:'<div role="form"><span role="button"><span role="link"></span></span></div>',tmplGroup:'<div role="group"></div>',tmplTooltip:'<div role="tooltip"></div>',tmplList:'<div role="list"></div>',tmplListbox:'<div role="listbox"></div>',tmplListitem:'<div role="listitem"%attrs%>%text%</div>',tmplSubmitBox:"<div></div>",tmplSubmit:'<button role="actionButton">submit</button>',tmplSearchBox:"<div></div>",tmplSearchInput:'<input name="_search" type="search" />',placeholderTitle:null,appendBody:!1,dropMod:!1,submitButton:!1,search:null,placeholderSearch:"Search",ajax:null,returnDetailsFormat:{optionValue:"id",optionContent:"name",optionSelected:"selected"},classHide:l+"-hide",classForm:l,classButton:n,classButtonOpen:o,classButtonEmpty:p,classButtonText:q,classGroup:r,classGroupShow:u,classTooltip:v,classSubmitBox:x,classSubmit:y,classSearchBox:z,classSearchInput:A,classList:w,classListbox:B,classListitem:C,classListitemHover:E,classListitemSelected:F,classLoader:G,callItemToggle:null,callBeforeChange:null},b.prototype={constructor:b,isOpen:!1,isGenerateItems:!1,initialize:function(){var b=this.options,d=this.$select;this._initHtml(),this._hideSelect(),d.attr("tabindex","-1").on("change."+c,a.proxy(this._onChangeSelect,this)),this.$fakeInput=a('<input tabindex="0">').addClass(b.classHide).on("focus keydown blur",a.proxy(this._onEventFake,this)).insertBefore(d),this._actualizeButtonText(),this.$content.insertAfter(d),this.isDisabled&&this.disable(),this.$button.on("click."+c+" touchend."+c,a.proxy(this._customSelectClickHandler,this)),this.$submitButton&&this.$submitButton.on("click."+c,a.proxy(this.submitChanges,this)),k.on("resize."+c,this.updateListPosition.bind(this))},destroy:function(){var a=this.$select;this.hide(),this.$content.remove(),this.$fakeInput.remove(),this._showSelect(),a.data(c,!1),a.off("."+c),k.off("."+c)},_onEventFake:function(a){switch(a.type){case"focus":this.show();break;case"blur":}},_onChangeSelect:function(){return this._actualizeListItems()._actualizeButtonText(),!0},_actualizeListItems:function(){var b=this.options.classListitemSelected,c=this.getListItems(),d=this.getSelected(),e={};return d.each2(function(){e[this.value]=this}),c.removeClass(b).each2(function(){var c=this.getAttribute("data-value");e[c]&&a(this).addClass(b)}),this},_actualizeButtonText:function(a){var b,c=this.options.placeholderTitle||this._getSelectedText();return a&&(b=this.getSelected().length,c=b?b+" "+this._nouns(b):c),this.$buttonText.text(c||this.$select.attr("placeholder")),this.$button.toggleClass(this.options.classButtonEmpty,!c),this},toggle:function(){return this._getDisabledState()?!1:(this.isOpen?this.hide():this.show(),!1)},submitChanges:function(){var b=this.getMarkedOptions();b.each(function(b,c){var d=a(c),e=d.data("value"),f=d.hasClass(this.options.classListitemSelected);d.removeClass(D),setTimeout(this.switchOption.bind(this,e,f)),this._actualizeButtonText(),this.hide()}.bind(this))},updateListPosition:function(){var a=this,b=a.options,c=a.$content,d=a.$group,e=c.offset(),f=d.outerHeight(),g=k.height(),h=c.outerHeight(),i=c.outerWidth(),j=k.scrollTop(),l=g-e.top-h-H,m=0,n="",o=e.top-j>f,p=l>f;!p&&o?(m=-f-H,n="up"):(m=h+H,n="down"),b.appendBody&&(e.top+=m,d.offset(e).outerWidth(i)),b.dropMod&&(n=b.dropMod),a.setMod(n,I,d)},setMod:function(a,b,c){this.removeModElement(c,b).addClass(b[a])},removeModElement:function(a,b){return a.removeClass(P(b).join(" "))},show:function(){return this.isOpen?!0:(j.trigger("event-show."+c),this._generateItems(),this.$group.addClass(this.options.classGroupShow).appendTo(this.options.appendBody&&document.body||this.$content).focus(),this.$searchInput&&this.$searchInput.focus(),this.updateListPosition(),this.isOpen=!0,this._eventsGroup(),this.$select.trigger("onToggle",!0),this)},hide:function(){this.isOpen=!1,this._eventsGroup(),this.$group.removeClass(this.options.classGroupShow),this.options.appendBody&&this.$group.offset({top:0,left:0}),this.$group.detach(),this.$select.trigger("onToggle"),this.save()},getSelectedDetail:function(){var a,b=[],c=this.options.returnDetailsFormat;return this.getSelected().each(function(){a={},a[c.optionValue]=this.value,a[c.optionContent]=this.textContent,a[c.optionSelected]=this.selected,b.push(a)}),b},on:function(){return this.$select.on.apply(this.$select,arguments),this},save:function(){var b,c=this,d=c.options.ajax||{},e=d.selectDataName||"selectedData",f={data:d.data||{}};return c.isAjaxSave?(f.data[e]=c.getSelectedDetail(),f=a.extend({},d,f),c.$select.trigger("beforeSave",f),b=a.ajax(f),c._showLoader(),c.$select.trigger("onSave",b),b.always(a.proxy(c._hideLoader,c)),c):c},replaceBtnClass:function(a){this.$content.removeClass().addClass(a)},_eventsGroup:function(){var b=this.options,d=this.$searchInput,e=this.isAjaxSearch?this._generateItemsWithAjax:this._searchItems;this.isOpen?(this.$group.on("touchmove."+c,a.proxy(this._touchmoveGroup,this)).on("click."+c+" touchend."+c,a.proxy(this._clickGroup,this)).on("mousedown."+c+" touchend."+c,"."+b.classListitem,a.proxy(this._clickListItem,this)).on("mouseover."+c+" mouseout."+c+" touchend."+c,"."+b.classListitem,a.proxy(this._hoverItem,this)),j.on("keydown."+c,a.proxy(this._keydownGroup,this)).on("mousedown."+c+" touchend."+c,a.proxy(this._clickDocument,this)).on("event-show."+c,a.proxy(this.hide,this)),d&&d.on("keyup."+c,a.proxy(e,this))):(this.$group.off("."+c),j.off("."+c),d&&d.off("."+c)),this.toggleButton()},_customSelectClickHandler:function(){return this.isAjax&&this.requestCounter<1?this._generateItemsWithAjax():this.toggle(),!1},toggleButton:function(){this.$button.toggleClass(this.options.classButtonOpen,this.isOpen)},enable:function(){this._toggleDisable(!1),this.isDisabled=!1},disable:function(){this.hide(),this._toggleDisable(!0),this.isDisabled=!0},addOptions:function(b,c){var d=this;return a.isArray(b)?(c=a.extend({removeNonSelected:!1},c||{}),d.isGenerateItems=!1,d._renderHiddenItems(b,c)._generateItems(),d):!1},update:function(a){return this.addOptions(a,{removeAll:!0})._actualizeButtonText()},_toggleDisable:function(a){this.$content.toggleClass(m,a),this.$select.prop("disabled",a)},_keydownGroup:function(a){var b=this.options;if(!this.isOpen)return!0;switch(a.which){case f:case e:return this._navGroupItem(a.which===f),!1;case g:case h:return this._navGroupItem(a.which===g),!1;case d:this.hide();break;case i:this._toggleListItemHover(),!this.isMultiple&&!b.submitButton&&this.hide()}},_navGroupItem:function(a){var b,c,d,e,f=this.options,g=f.classListitemHover,h=this.getListItems(),i=this._getListItemsHover(h);a?(b=i.length&&i.nextAll(":not(:hidden):first"),b=b.length&&b||h.filter(":not(:hidden):first")):(b=i.length&&i.prevAll(":not(:hidden):first"),b=b.length&&b||h.filter(":not(:hidden):last")),c=this.$list.height(),d=this.$list.scrollTop(),e=b.position(),e=e.top,c<e+b.outerHeight()?this.$list.scrollTop(d+(e+b.outerHeight()-c)):0>e&&this.$list.scrollTop(d+e),i.removeClass(g),b.addClass(g)},_clickGroup:function(){},_clickDocument:function(b){var c=!!a(b.target).closest(this.$group).length,d=!!a(b.target).closest(this.$content).length;return d?!0:void(c||this.hide())},_toggleListItemHover:function(){var a=this._getListItemsHover();a.length&&this._switchListItem(a,!a.hasClass(this.options.classListitemSelected))},_hoverItem:function(b){var c=this.getListItems(),d=this.options.classListitemHover,e=a(b.currentTarget);switch(b.type){case"mouseover":case"touchend":"touchend"===b.type&&c.removeClass(d),e.addClass(d);break;case"mouseout":c.removeClass(d)}},_touchmoveGroup:function(){this.isTouchMove=!0},_clickListItem:function(b){if(this.isTouchMove)return this.isTouchMove=!1,!0;var c=this.options,d=c.classListitemSelected,e=a(b.currentTarget),f=!e.hasClass(d),g=!this.isMultiple&&!c.submitButton;g&&this.getListItems().removeClass(d),this._switchListItem(e,f),g&&this.hide(),(this.isAjax||this.isAjaxSearch)&&this._actualizeButtonText(!0)},_switchListItem:function(a,b){var c=this.options,d=this.options.callBeforeChange,e=!0,f=a.data("value"),g={value:f,selected:b};return M(d)&&(e=d(g)),this.$select.trigger("beforeChange",g),e?(this.isMultiple||a.siblings().removeClass(c.classListitemSelected),a.toggleClass(c.classListitemSelected,b),this.options.submitButton?void a.addClass(D):void this.switchOption(a.data("value"),b)):!1},switchOption:function(a,b,c){c=c||{};var d=this.$select,e=d.find('option[value="'+a+'"]'),f=this.options.callItemToggle,g={value:a,selected:b};e.prop("selected",b),!b&&e.removeAttr("selected"),M(f)&&f(g),c.silent||d.trigger("change"),d.trigger("itemToggle",g)},getListItems:function(){return this.$listItems||a()},isEmpty:function(){return!this.getListItems().length},_getListItemsHover:function(a){return a=a||this.getListItems(),a.filter("."+this.options.classListitemHover)},_getSelectedText:function(){var b="";return this.getSelected().each(function(){b+=(b?", ":"")+a(this).text()}),b},getSelected:function(){var b=this.$select,c=b.val(),d=a();if(N(c))d=b.find('[value="'+c+'"]');else if(O(c)){var e=b.find("[value]");c.forEach(function(a){var b=e.filter('[value="'+a+'"]');d=d&&d.add(b)||b})}return d},getNotSelected:function(){return this.$select.find("option:not(:checked)")},getMarkedOptions:function(){return this.$list.find("."+D)},_hideSelect:function(){this.$select.addClass(this.options.classHide)},_showSelect:function(){this.$select.removeClass(this.options.classHide)},_searchItems:function(b){var c=a(b.currentTarget),d=c.val();return c.data("lastSearch")===d?!1:(c.data("lastSearch",d),void this.$listItems.each2(function(a,b){var c=b[0],e=c.innerHTML;d=d.replace(/\\/g,""),c.style.display=~e.search(new RegExp(d,"i"))?"":"none"}))},_generateItemsWithAjax:function(){return K&&(K=clearTimeout(K)),K=setTimeout(a.proxy(this._sendRequest,this),this.options.ajax.delay),this},_sendRequest:function(){var b=this.options.ajax,c=this.$searchInput&&this.$searchInput.attr("name"),d=this.$searchInput&&this.$searchInput.val();return K=clearTimeout(K),!d&&this.isOpen?(this.getNotSelected().remove(),this.isGenerateItems=!1,this._generateItems(),this._actualizeButtonText(!0),this):(this._showLoader(),b.data||(b.data={}),c&&(b.data[c]=d),b.success=a.proxy(this._onAjaxSuccess,this),b.error=a.proxy(this._onAjaxError,this),this.requestCounter?++this.requestCounter:this.requestCounter=1,a.ajax(b),this)},_onAjaxSuccess:function(a){this.isGenerateItems=!1,M(this.options.ajax.resFormat)&&(a=this.options.ajax.resFormat(a)),this._hideLoader()._renderHiddenItems(a),this.isOpen?this._generateItems():this.show(),this._actualizeButtonText(!0)},_onAjaxError:function(){console.warn("Connection error"),this._hideLoader()},_showLoader:function(){return this.$loaderContainer=this.isOpen?this.$group:this.$button,this.$loaderContainer.addClass(this.options.classLoader),this},_hideLoader:function(){return this.$loaderContainer.removeClass(this.options.classLoader),this},_nouns:function(a){if(!this.options.plural)return!1;var b=this.options.plural.split(",");return 1===a?b[0]:a>1&&5>a?b[1]:b[2]||b[1]},_renderHiddenItems:function(b,c){var d,e,f,g,h,i=this,j={removeNonSelected:!0,removeAll:!1},k=this.options.returnDetailsFormat;return a.extend(j,c||{}),b&&O(b)&&(e="",b.forEach(function(a){return f=a[k.optionValue],g=a[k.optionContent],h=a[k.optionSelected],d=i.$select.find('option[value="'+f+'"]').length,d&&!j.removeAll?!0:void(e+='<option value="'+f+'"'+(a.selected?' selected="selected"':"")+">"+g+"</option>")})),j.removeNonSelected&&!j.removeAll&&this.getNotSelected().remove(),j.removeAll&&this.$select.empty(),e&&this.$select.append(e),this},_initHtml:function(){var b=this.options;this.$content=a(b.tmplContent).addClass(b.classForm),this.$button=this.$content.find("[role=button]").addClass(b.classButton),this.$buttonText=this.$content.find("[role=link]").addClass(b.classButtonText),this.$group=a(b.tmplGroup).addClass(b.classGroup),this.$list=this.isMultiple?a(b.tmplListbox).addClass(b.classListbox):a(b.tmplList).addClass(b.classList),this.$listItem=a(b.tmplListitem).addClass(b.classListitem),this.$listItems=a(),this.options.tooltip&&(this.$tooltip=a(b.tmplTooltip).addClass(b.classTooltip).html(this.options.tooltip),this.$group.append(this.$tooltip)),this.$group.append(this.$list),b.submitButton&&(this.$submitBox=a(b.tmplSubmitBox).addClass(b.classSubmitBox),this.$submitButton=a(b.tmplSubmit).addClass(b.classSubmit),this.$submitBox.append(this.$submitButton).appendTo(this.$group))},_generateItems:function(){if(this.isGenerateItems)return!0;var b,c=this.options,d=(a(),this.$listItem),e=d[0],f="",g=document.createElement("div"),h=this.$select.contents("option");g.appendChild(e),b=g.innerHTML,h.each2(function(){var a=this.innerHTML,c=this.value,d=b;return a?(d=d.replace("%attrs%",' data-value="'+c+'"'),d=d.replace("%text%",a),void(f+=d)):!0}),(c.search||null===c.search&&h.length>10)&&!this.$searchInput&&(this.$searchBox=a(c.tmplSearchBox).addClass(c.classSearchBox),this.$searchInput=a(c.tmplSearchInput).addClass(c.classSearchInput).attr("placeholder",c.placeholderSearch),this.$searchBox.append(this.$searchInput).insertBefore(this.$list)),this.$listItems=a(f),this.$list.html(this.$listItems),this._actualizeListItems(),this.isGenerateItems=!0},_fixSelect:function(){var a=this.$select,b=a.find(":not([value])");b.length||this.isMultiple||a.prepend('<option selected="selected"></option>')},_getDisabledState:function(){return this.isDisabled}},a.fn[c]=function(d){var e,f=Array.prototype.slice.call(arguments,1);return this.each(function(){var g=a(this),h=g.data(),i=g.data(c),j=a.extend({},b.DEFAULTS,h,"object"==typeof d&&d);j.ajax&&(j.ajax=a.extend({},J,j.ajax)),i||g.data(c,i=new b(this,j)),"string"==typeof d&&M(i[d])&&("_"!==d.charAt(0)?e=i[d].apply(i,f):console.warn(c,"Do not use private methods!")),e||(e=g)}),e},a.fn[c].Constructor=b,Array.prototype.forEach||(Array.prototype.forEach=function(a,b){for(var c=0,d=this.length;d>c;++c)a.call(b,this[c],c,this)}),"undefined"==typeof a.fn.each2&&a.extend(a.fn,{each2:function(b){for(var c=a([0]),d=-1,e=this.length;++d<e&&(c.context=c[0]=this[d])&&b.call(c[0],d,c)!==!1;);return this}})}(jQuery);
//# sourceMappingURL=jquery.select-edit.min.js.map